\documentclass[letterpaper,11pt]{article}

\usepackage{latexsym}
\usepackage[empty]{fullpage}
\usepackage{titlesec}
\usepackage{marvosym}
\usepackage[usenames,dvipsnames]{color}
\usepackage{verbatim}
\usepackage{enumitem}
\usepackage[hidelinks]{hyperref}
\usepackage{fancyhdr}
\usepackage[english]{babel}
\usepackage{tabularx}
\usepackage{xcolor}
\usepackage{fontawesome5}
\usepackage{graphicx}
\usepackage{lmodern}

\input{glyphtounicode}

\pagestyle{fancy}
\fancyhf{} % clear all header and footer fields
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% Adjust margins
\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\evensidemargin}{-0.5in}
\addtolength{\textwidth}{1in}
\addtolength{\topmargin}{-1in} % Default was -.5in
\addtolength{\textheight}{1.0in}

\urlstyle{same}

\raggedbottom
\raggedright
\setlength{\tabcolsep}{0in}

% Section formatting
\titleformat{\section}{
  \vspace{-5pt}\scshape\raggedright\large
}{}{0em}{}[\color{black}\titlerule \vspace{-5pt}]

% Subsection formatting
\titleformat{\subsection}{
  \vspace{-4pt}\scshape\raggedright\large
}{\hspace{-.15in}}{0em}{}[\color{black}\vspace{-8pt}]

% Ensure that generate pdf is machine readable/ATS parsable
\pdfgentounicode=1

\usepackage{enumitem}
\setlist[itemize]{label=\textbullet}

% -------------------- CUSTOM COMMANDS --------------------
\newcommand{\resumeItem}[1]{
  \item\small{
    {#1 \vspace{-2pt}}
  }
}
\newcommand{\sectionItem}[3]{
    \item
    \begin{tabular*}{0.97\textwidth}{l@{\extracolsep{\fill}}r}
      \small\textbf{#1} \\ \textbar \footnotesize\emph{#2} & #3 \\
    \end{tabular*}\vspace{-7pt}
}

\newcommand{\resumeItemListStart}{\begin{itemize}}
\newcommand{\resumeItemListEnd}{\end{itemize}\vspace{-5pt}}
\newcommand{\sectionItemsListStart}{\begin{itemize}[leftmargin=0.15in, label={}]}
\newcommand{\sectionItemsListEnd}{\end{itemize}}

\setlength{\footskip}{4.08003pt}
% Document main 
\begin{document}

\begin{flushright}
    % \vspace{-4pt}
    \color{gray}
    \item
    Last Updated $last-updated$.
  \end{flushright}
  
  \vspace{-5pt}
  
  \begin{center}
      \textbf{\Huge \scshape $name.first$ $name.last$} \\ \vspace{8pt}
      \small 
      $for(resume-links)$
      \faIcon{$resume-links.name$}
      \href{$resume-links.link$}{\underline{$resume-links.text$}}\hspace{5pt}
      $endfor$
  \end{center}

  \textbf{$job-title$}. \emph{$long-summary$}

  \section{$research-section.header$}\label{$research-section.label$}
  \sectionItemsListStart
  $for(research-section.items)$
    $if(research-section.items.publication)$ % if item has a publication and link, use that. 
      \sectionItem
      {$research-section.items.title$}
      {
        $for(research-section.items.annotations/allbutlast)$
        $research-section.items.annotations$, $endfor$
        $research-section.items.annotations/last$.
        $if(research-section.items.comments)$
        ($research-section.items.comments$)
        $endif$
      }
      { 
        \href{$research-section.items.publication-link$}{
        \textbf{$research-section.items.publication$}}
      }
    $else$ % otherwise, use the start and end date.
      \sectionItem
      {$research-section.items.title$}
      {
        $for(research-section.items.annotations/allbutlast)$
        $research-section.items.annotations$, $endfor$
        $research-section.items.annotations/last$.
        $if(research-section.items.comments)$
        ($research-section.items.comments$)
        $endif$
      }
      {
        $research-section.items.start-date$ -- $research-section.items.end-date$
      }
    $endif$
  $endfor$
  \sectionItemsListEnd

  \section{$experience-section.header$}\label{$experience-section.label$}
  \sectionItemsListStart
  $for(experience-section.items)$
    \sectionItem
    {$experience-section.items.title$}
    {
      $for(experience-section.items.annotations/allbutlast)$
      $experience-section.items.annotations$, $endfor$
      $experience-section.items.annotations/last$.
      $if(experience-section.items.comments)$
      ($experience-section.items.comments$)
      $endif$
    }
    {
      $experience-section.items.start-date$ -- $experience-section.items.end-date$
    }
    $for(experience-section.items.notes/first)$
    \resumeItemListStart 
      \resumeItem{$experience-section.items.notes/first$}
    \resumeItemListEnd
    $endfor$
  $endfor$
  \sectionItemsListEnd
  
  \section{$education-section.header$}\label{$education-section.label$}
  \sectionItemsListStart
  $for(education-section.items)$
    \sectionItem
    {$education-section.items.title$}
    {
      $for(education-section.items.annotations/allbutlast)$
      $education-section.items.annotations$, $endfor$
      $education-section.items.annotations/last$.
      $if(education-section.items.comments)$
      ($education-section.items.comments$)
      $endif$
    }
    {
      $education-section.items.start-date$ -- $education-section.items.end-date$
    }
  $endfor$
  \sectionItemsListEnd

  \section{$references-section.header$}\label{$references-section.label$}
  \sectionItemsListStart
  $for(references-section.items)$
    \sectionItem
    {$references-section.items.title$}
    {
      $for(references-section.items.annotations/allbutlast)$
      $references-section.items.annotations$, $endfor$
      $references-section.items.annotations/last$.
      $if(references-section.items.comments)$
      ($references-section.items.comments$)
      $endif$
    }
    {}
  $endfor$
  \sectionItemsListEnd


\end{document}